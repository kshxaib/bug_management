{% extends "base.html" %}

{% block title %}Manage Bugs{% endblock %}

{% block content %}
<div class="space-y-6">
    <h1 class="text-3xl font-bold text-primary animate-fade-in">üõ†Ô∏è Manage Bugs</h1>

    <div class="overflow-x-auto bg-white rounded-xl shadow-md p-4 animate-fade-in">
        <table class="min-w-full table-auto text-sm text-left text-gray-800">
            <thead class="bg-gray-100 text-gray-700 uppercase">
                <tr>
                    <th class="px-4 py-2">ID</th>
                    <th class="px-4 py-2">Title</th>
                    <th class="px-4 py-2">Description</th>
                    <th class="px-4 py-2">Status</th>
                    <th class="px-4 py-2">Priority</th>
                    <th class="px-4 py-2">Creator</th>
                    <th class="px-4 py-2">Assignee</th>
                    <th class="px-4 py-2">Created At</th>
                    <th class="px-4 py-2">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for bug in bugs %}
                <tr class="border-t hover:bg-gray-50 transition">
                    <td class="px-4 py-2">{{ bug.id }}</td>
                    <td class="px-4 py-2">{{ bug.title }}</td>
                    <td class="px-4 py-2">{{ bug.description|truncate(50) }}</td>
                    <td class="px-4 py-2">
                        <span class="status-badge">{{ bug.status }}</span>
                    </td>
                    <td class="px-4 py-2">
                        <span class="priority-badge">{{ bug.priority }}</span>
                    </td>
                    <td class="px-4 py-2">{{ bug.creator.username }}</td>
                    <td class="px-4 py-2">
                        {% if bug.assignee %}
                            <span class="inline-block text-sm font-extrabold px-2 text-green-600 py-1 rounded-full font-medium justify-center flex">
                                {{ bug.assignee.username }}
                            </span>
                        {% else %}
                            <span class="inline-block text-xs px-2 py-1 rounded-full font-medium justify-center flex">
                                ---
                            </span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">{{ bug.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td class="px-4 py-2 space-y-1">
                        <!-- Status Update Form -->
                        <form method="POST" action="{{ url_for('update_bug_status', bug_id=bug.id) }}">
                            <select name="status" onchange="this.form.submit()"
                                class="rounded-md border-gray-300 shadow-sm text-sm px-2 py-1 w-full">
                                <option value="Open" {% if bug.status == 'Open' %}selected{% endif %}>Open</option>
                                <option value="In Progress" {% if bug.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                                <option value="Closed" {% if bug.status == 'Closed' %}selected{% endif %}>Closed</option>
                            </select>
                        </form>

                        <!-- Assignee Update Form -->
                        <form method="POST" action="{{ url_for('assign_bug', bug_id=bug.id) }}">
                            <select name="assignee_id" onchange="this.form.submit()"
                                class="rounded-md border-gray-300 shadow-sm text-sm px-2 py-1 w-full">
                                <option value="">Assign to...</option>
                                {% for user in users %}
                                <option value="{{ user.id }}" {% if bug.assignee_id == user.id %}selected{% endif %}>
                                    {{ user.username }}
                                </option>
                                {% endfor %}
                            </select>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Custom Animations and Badges -->
<style>
    @layer utilities {
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    }
</style>

<style>
    .status-badge {
        @apply inline-block px-2 py-1 rounded-full text-xs font-medium bg-gray-200;
    }

    .priority-badge {
        @apply inline-block px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700;
    }
</style>
{% endblock %}
